<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.0/backbone-min.js"></script>

<style type="text/css">
	#search-box{width: 50%;float: left; padding: 20px; box-sizing: border-box; }
	#search-box input{width: 300px;}
</style>
</head>
<script>
	//clase general de la vista	
	window.SearchView = Backbone.View.extend({
		//interacciones
		events:{
			"click button": "search",
			"keypress input": "keyHandler"
		},


		//Como empieza
		initialize: function(config){
			//elemento en DOM de la vista
			this.$el;
			this.$el = config.$el;
		},
		//como se muestra al usario
		render:function(){},

		search:function(event){
			//PROCESO DE BUSQUEDA :: GUARDA EL VALOR DE BUSQUEDA Y LUEGO LIMPIA
			var value = this.$el.find("input").val();
			this.$el.find("input").val("");
			//console.log("el valor a buscar es " + value);

			self = this;

			self.$el.find("#videos").html("");

			//PIDIENDO INFORMACION A YOUTUBE
			var youtube = $.getJSON("http://gdata.youtube.com/feeds/videos?vq="+value+"&max-results=10&alt=json-in-script&callback=?")

			youtube.done(function(data){
				//debugger;
				var videos = data.feed.entry.map(function(item){
					return {
						title: item.title.$t,
						thumb: item.media$group.media$thumbnail[0].url
					}

				});
				//console.log(videos[0]);
				videos.forEach(function(videoData){
					var videoHTML = window.templates.videoTemplate(videoData);

					self.$el.find("#videos").prepend(videoHTML);


				});

			});
		},

		keyHandler:function(event){

			if(event.which === 13){
				//ejecuta la funcion de la vista
				this.search();
			}

		},

	});




	$().ready(function(){
		
		//Instancia con quien va interactuar el usuario
		window.searchBox = new window.SearchView({
			$el: $("#search-box")
		});


	//Uso de templates de underscore
	_.templateSettings = {interpolate : /\{\{(.+?)\}\}/g, evaluate : /\{!(.+?)!\}/g };
    window.templates = {};
    templates.videoTemplate = _.template( $("#videoTemplate").html() );


	});
</script>
<body>
 <div id="search-box">
 	<p>Buscar: <input type="text"><button>buscar</button></p>
 	<div id="videos"></div>
 </div>
 <div id="favorits"></div>

<script id="videoTemplate" type="text/template">
	<div>
		<h4>{{ title }}</h4>
		<img src="{{ thumb }}"/>
		<span class="favorite">Favorito</span>
	</div>
</script>  

</body>
</html>